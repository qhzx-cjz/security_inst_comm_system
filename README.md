# 安全即时通讯应用

这是一个安全即时通讯应用的前端部分，使用 Remix、TypeScript 和 Tailwind CSS 构建。它与一个基于 Python FastAPI 的后端进行通信，以提供实时、端到端加密的聊天功能。

## 项目概述

该应用包含两个主要部分：
-   **前端**: 一个使用 [Remix](https://remix.run/) 构建的现代化 Web 应用。负责用户界面、用户交互和客户端的加密操作。
-   **后端**: 一个使用 [FastAPI](https://fastapi.tiangolo.com/) 构建的 Python 服务器。负责用户认证、管理 WebSocket 连接以及在客户端之间转发消息。

## 通信流程

本应用结合了 REST API（用于登录/注册等状态操作）和 WebSocket（用于实时通信）来实现其功能。端到端加密确保了服务器永远无法读取消息内容。

1.  **用户注册**:
    *   **前端**: 用户提交用户名和密码。
    *   **后端 (`POST /api/user/register`)**: 后端对密码进行哈希处理，并将新用户存入数据库。

2.  **用户登录**:
    *   **前端**: 用户提交用户名和密码。
    *   **后端 (`POST /api/user/login`)**: 后端验证凭据。如果成功，它会生成一个 JSON Web Token (JWT) 并返回给客户端。

3.  **实时连接**:
    *   **前端**: 登录后，应用使用 JWT 与服务器的 `/ws` 端点建立 WebSocket 连接。
    *   **后端**: 服务器验证 Token。连接成功后：
        *   向新客户端发送当前在线用户的列表 (`friends:online_list`)。
        *   向所有其他客户端广播一个新用户上线的通知 (`friend:online`)。

4.  **端到端加密消息**:
    *   **密钥交换**: 要向另一用户发送消息，客户端首先从服务器请求接收方的公钥 (`GET /api/users/{username}/key`)。
    *   **加密与发送**: 消息使用接收方的公钥在本地加密。然后，加密后的负载通过 WebSocket 发送到服务器，并指定接收方。
    *   **消息转发**: 后端接收加密消息，并将其转发到正确的接收方的 WebSocket 连接，而无需解密。
    *   **解密与显示**: 接收方的客户端接收加密消息，并使用其私钥在本地解密，然后显示消息。

5.  **用户状态更新**:
    *   当用户断开连接时，后端会向所有剩余的在线用户广播一条 `friend:offline` 消息。
    *   前端会更新好友列表界面以反映在线状态的变化。

## 开发

运行开发服务器：

```sh
npm run dev
```

## 部署

首先，为生产环境构建您的应用：

```sh
npm run build
```

然后在生产模式下运行应用：

```sh
npm start
```
